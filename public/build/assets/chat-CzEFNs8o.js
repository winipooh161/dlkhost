import{f as j,c as B,r as v,a as O}from"./notification-BRw4-1-H.js";import"./index.esm2017-BXvIz_HN.js";function q(r){const d=r.parentElement,c=document.createElement("button"),a=document.createElement("div");c.textContent="üòâ",c.type="button",c.classList.add("emoji-button"),a.classList.add("emoji-picker"),a.style.position="absolute",a.style.bottom="50px",a.style.left="10px";const u=["üòÄ","üòÅ","üòÇ","ü§£","üòÉ","üòÑ","üòÖ","üòÜ","üòâ","üòä","üòç","üòò","üòú","üòé","üò≠","üò°","üòá","üòà","üôÉ","ü§î","üò•","üòì","ü§©","ü•≥","ü§Ø","ü§¨","ü§°","üëª","üíÄ","üëΩ","ü§ñ","üéÉ","üê±","üê∂","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","ü¶Å","üêÆ","üê∑","üê∏","üêµ","üêî","üêß","üê¶","üåπ","üåª","üå∫","üå∑","üåº","üçé","üçì","üçí","üçá","üçâ","üçã","üçä","üçå","ü•ù","üçç","ü•≠"];let h="";u.forEach(l=>{h+=`<span class="emoji-item">${l}</span>`}),a.innerHTML=h,a.addEventListener("click",l=>{if(l.target.classList.contains("emoji-item")){const f=l.target.textContent,m=r.selectionStart,y=r.value.substring(0,m),C=r.value.substring(m);r.value=y+f+C;const L=m+f.length;r.selectionStart=L,r.selectionEnd=L,r.focus()}}),d.appendChild(c),d.appendChild(a),a.style.display="none",c.addEventListener("click",l=>{l.stopPropagation(),a.style.display=a.style.display==="none"?"flex":"none"}),document.addEventListener("click",l=>{!a.contains(l.target)&&!c.contains(l.target)&&(a.style.display="none")})}document.addEventListener("DOMContentLoaded",()=>{var k;const r=window.Laravel.user.id,d=document.querySelector('meta[name="csrf-token"]').getAttribute("content");let c=null,a=null,u=new Set,h=!1;async function l(n,e={}){try{const s=await fetch(n,e);if(!s.ok){const t=await s.text();throw new Error(`HTTP ${s.status}: ${t}`)}return await s.json()}catch(s){throw console.error("Fetch error:",s),s}}function f(n,e){c=n,a=e;const t=document.getElementById("chat-messages").querySelector("ul");t.innerHTML="",u.clear();const o=document.querySelector(`[data-chat-id="${n}"][data-chat-type="${e}"] h5`);document.getElementById("chat-header").textContent=o?o.textContent:"–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è",l(`/chats/${e}/${n}/messages`).then(i=>{i.messages&&i.messages.length>0&&(window.lastLoadedMessageId=i.messages[i.messages.length-1].id),v(i.messages,r,u,d,a,c),y(n,e),C(n,e)}).catch(i=>console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:",i))}function m(){if(!c||!g.value.trim()&&!document.querySelector(".file-input").files[0])return;const n=g.value.trim(),s=document.querySelector(".file-input").files;let t=new FormData;t.append("message",n);for(let o=0;o<s.length;o++)t.append("files[]",s[o]);fetch(`/chats/${a}/${c}/messages`,{method:"POST",headers:{"X-CSRF-TOKEN":d},body:t}).then(o=>o.ok?o.json():o.text().then(i=>{throw new Error(i)})).then(o=>{o.message&&(v([o.message],o.message.sender_id,u,d,a,c),g.value="",document.querySelector(".file-input").value="")}).catch(o=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:",o))}function y(n,e){fetch(`/chats/${e}/${n}/mark-read`,{method:"POST",headers:{"X-CSRF-TOKEN":d}}).catch(s=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–º–µ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:",s))}function C(n,e){window.Echo&&window.Echo.channel(`chat.${e}.${n}`).listen("MessageSent",s=>{console.log("–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≤–µ–±-—Å–æ–∫–µ—Ç:",s),u.has(s.message.id)||(v([s.message],r,u,d,a,c),y(n,e))})}setInterval(()=>{if(c&&a){const n=document.getElementById("chat-messages");if(!n||!n.querySelector("ul"))return;const s=window.lastLoadedMessageId||0;fetch(`/chats/${a}/${c}/new-messages`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":d},body:JSON.stringify({last_message_id:s})}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(t=>{if(t.messages&&t.messages.length>0){const o=t.messages[t.messages.length-1];window.lastLoadedMessageId=o.id,v(t.messages,t.current_user_id,u,d,a,c),y(c,a)}}).catch(t=>{console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:",t)})}},2e3);function L(n,e){let s;return function(...t){clearTimeout(s),s=setTimeout(()=>n.apply(this,t),e)}}const b=document.getElementById("chat-list");b&&b.addEventListener("click",n=>{const e=n.target.closest("li");if(!e)return;const s=e.getAttribute("data-chat-id"),t=e.getAttribute("data-chat-type");c===s&&a===t||f(s,t)});const w=document.getElementById("search-chats"),p=document.getElementById("search-results");w&&w.addEventListener("input",L(function(){const n=w.value.trim().toLowerCase();n===""?(p.style.display="none",Array.from(chatList.children).forEach(e=>{e.style.display="flex"})):(Array.from(chatList.children).forEach(e=>{const s=e.querySelector("h5").textContent.toLowerCase();e.style.display=s.includes(n)?"flex":"none"}),fetch("/chats/search",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":d},body:JSON.stringify({query:n})}).then(e=>e.json()).then(e=>{let s="";e.chats&&e.chats.length>0&&(s+="<h5>–ß–∞—Ç—ã</h5><ul>",e.chats.forEach(t=>{s+=`<li data-chat-id="${t.id}" data-chat-type="${t.type}">${t.name}</li>`}),s+="</ul>"),e.messages&&e.messages.length>0&&(s+="<h5>–°–æ–æ–±—â–µ–Ω–∏—è</h5><ul>",e.messages.forEach(t=>{let o=t.chat_id,i="group";o||(i="personal",o=t.sender_id==r?t.receiver_id:t.sender_id),s+=`<li data-chat-id="${o}" data-chat-type="${i}" data-message-id="${t.id}">
                                <strong>${t.sender_name}:</strong> ${t.message.substring(0,50)}...
                                <br><small>${O(t.created_at)}</small>
                            </li>`}),s+="</ul>"),p.innerHTML=s,p.style.display=s.trim()===""?"none":"block",Array.from(p.querySelectorAll("li")).forEach(t=>{t.addEventListener("click",function(){const o=this.getAttribute("data-chat-id"),i=this.getAttribute("data-chat-type"),T=this.getAttribute("data-message-id");f(o,i),w.value="",p.style.display="none",T&&setTimeout(()=>{},1e3)})})}).catch(e=>console.error("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:",e)))},300));function I(){const n=document.querySelector(".attach-file"),e=document.querySelector(".file-input");n&&e&&(n.addEventListener("click",()=>{e.click()}),e.addEventListener("change",()=>{e.files.length>0&&m()}))}document.readyState!=="loading"?I():document.addEventListener("DOMContentLoaded",I);const S=document.getElementById("send-message"),g=document.getElementById("chat-message");S&&S.addEventListener("click",m),g&&g.addEventListener("keypress",n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),m())}),q(g);const $=(k=document.getElementById("chat-list"))==null?void 0:k.querySelector("li");$&&$.click();const M=document.getElementById("toggle-pinned");M&&M.addEventListener("click",()=>{h=!h,M.textContent=h?"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è":"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ",j(h)}),B();const E=document.getElementById("chat-messages");if(E){const n=document.createElement("div");n.id="scroll-sentinel",E.appendChild(n),new IntersectionObserver(s=>{s.forEach(t=>{if(t.isIntersecting){const o=parseInt(E.getAttribute("data-page")||"1");c&&a?l(`/chats/${a}/${c}/messages?page=${o+1}`).then(i=>{i.messages&&i.messages.length>0&&E.setAttribute("data-page",o+1)}).catch(i=>console.error("–û—à–∏–±–∫–∞ –ø–æ–¥–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:",i)):console.warn("–ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–∞—Ç–∞: currentChatId –∏–ª–∏ currentChatType –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã")}})},{root:E,threshold:1}).observe(n)}});
