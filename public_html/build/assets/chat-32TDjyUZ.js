import{f as C,a as I,c as $,r as k}from"./notification-COxFhJKv.js";import"./index.esm2017-NZQW5Whv.js";function b(l){const d=l.parentElement,c=document.createElement("button"),o=document.createElement("div");c.textContent="üòâ",c.type="button",c.classList.add("emoji-button"),o.classList.add("emoji-picker"),o.style.position="absolute",o.style.bottom="50px",o.style.left="10px";const g=["üòÄ","üòÅ","üòÇ","ü§£","üòÉ","üòÑ","üòÖ","üòÜ","üòâ","üòä","üòç","üòò","üòú","üòé","üò≠","üò°","üòá","üòà","üôÉ","ü§î","üò•","üòì","ü§©","ü•≥","ü§Ø","ü§¨","ü§°","üëª","üíÄ","üëΩ","ü§ñ","üéÉ","üê±","üê∂","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","ü¶Å","üêÆ","üê∑","üê∏","üêµ","üêî","üêß","üê¶","üåπ","üåª","üå∫","üå∑","üåº","üçé","üçì","üçí","üçá","üçâ","üçã","üçä","üçå","ü•ù","üçç","ü•≠"];let f="";g.forEach(i=>{f+=`<span class="emoji-item">${i}</span>`}),o.innerHTML=f,o.addEventListener("click",i=>{if(i.target.classList.contains("emoji-item")){const y=i.target.textContent,p=l.selectionStart,u=l.value.substring(0,p),E=l.value.substring(p);l.value=u+y+E;const h=p+y.length;l.selectionStart=h,l.selectionEnd=h,l.focus()}}),d.appendChild(c),d.appendChild(o),o.style.display="none",c.addEventListener("click",i=>{i.stopPropagation(),o.style.display=o.style.display==="none"?"flex":"none"}),document.addEventListener("click",i=>{!o.contains(i.target)&&!c.contains(i.target)&&(o.style.display="none")})}document.addEventListener("DOMContentLoaded",()=>{const l=window.Laravel.user.id,d=document.querySelector('meta[name="csrf-token"]').getAttribute("content");let c=null,o=null,g=new Set,f=!1;function i(s,t){c=s,o=t;const e=document.getElementById("chat-messages").querySelector("ul");e.innerHTML="",g.clear();const n=document.querySelector(`[data-chat-id="${s}"][data-chat-type="${t}"] h5`),m=document.getElementById("chat-header");m.textContent=n?n.textContent:"–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è",fetch(`/chats/${t}/${s}/messages`).then(r=>{if(!r.ok)throw new Error("Network response was not ok");return r.json()}).then(r=>{if(g.clear(),r.messages&&r.messages.length>0){const w=r.messages[r.messages.length-1];window.lastLoadedMessageId=w.id}k(r.messages,l,g,d,o,c),p(s,t)}).catch(r=>{console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:",r)})}function y(){if(!c||!L.value.trim()&&!document.querySelector(".file-input").files[0])return;const s=L.value.trim(),a=document.querySelector(".file-input").files;let e=new FormData;e.append("message",s);for(let n=0;n<a.length;n++)e.append("files[]",a[n]);fetch(`/chats/${o}/${c}/messages`,{method:"POST",headers:{"X-CSRF-TOKEN":d},body:e}).then(n=>n.ok?n.json():n.text().then(m=>{throw new Error(m)})).then(n=>{n.message&&(k([n.message],n.message.sender_id,g,d,o,c),L.value="",document.querySelector(".file-input").value="")}).catch(n=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:",n))}function p(s,t){fetch(`/chats/${t}/${s}/mark-read`,{method:"POST",headers:{"X-CSRF-TOKEN":d}}).catch(a=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–º–µ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:",a))}setInterval(()=>{if(c&&o){const s=document.getElementById("chat-messages");if(!s||!s.querySelector("ul"))return;const a=window.lastLoadedMessageId||0;fetch(`/chats/${o}/${c}/new-messages`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":d},body:JSON.stringify({last_message_id:a})}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{if(e.messages&&e.messages.length>0){const n=e.messages[e.messages.length-1];window.lastLoadedMessageId=n.id,k(e.messages,e.current_user_id,g,d,o,c),p(c,o)}}).catch(e=>{console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:",e)})}},1e3);const u=document.getElementById("chat-list");u&&u.addEventListener("click",s=>{const t=s.target.closest("li");if(!t)return;const a=t.getAttribute("data-chat-id"),e=t.getAttribute("data-chat-type");c===a&&o===e||i(a,e)});const E=document.getElementById("search-chats"),h=document.getElementById("search-results");E&&E.addEventListener("input",function(){const s=E.value.trim().toLowerCase();s===""?(h.style.display="none",Array.from(u.children).forEach(t=>{t.style.display="flex"})):(Array.from(u.children).forEach(t=>{const a=t.querySelector("h5").textContent.toLowerCase();t.style.display=a.includes(s)?"flex":"none"}),fetch("/chats/search",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":d},body:JSON.stringify({query:s})}).then(t=>t.json()).then(t=>{let a="";t.chats&&t.chats.length>0&&(a+="<h5>–ß–∞—Ç—ã</h5><ul>",t.chats.forEach(e=>{a+=`<li data-chat-id="${e.id}" data-chat-type="${e.type}">${e.name}</li>`}),a+="</ul>"),t.messages&&t.messages.length>0&&(a+="<h5>–°–æ–æ–±—â–µ–Ω–∏—è</h5><ul>",t.messages.forEach(e=>{let n=e.chat_id,m="group";n||(m="personal",n=e.sender_id==l?e.receiver_id:e.sender_id),a+=`<li data-chat-id="${n}" data-chat-type="${m}" data-message-id="${e.id}">
                                <strong>${e.sender_name}:</strong> ${e.message.substring(0,50)}...
                                <br><small>${C(e.created_at)}</small>
                            </li>`}),a+="</ul>"),h.innerHTML=a,h.style.display=a.trim()===""?"none":"block",Array.from(h.querySelectorAll("li")).forEach(e=>{e.addEventListener("click",function(){const n=this.getAttribute("data-chat-id"),m=this.getAttribute("data-chat-type"),r=this.getAttribute("data-message-id");i(n,m),E.value="",h.style.display="none",r&&setTimeout(()=>{},1e3)})})}).catch(t=>console.error("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:",t)))});function v(){const s=document.querySelector(".attach-file"),t=document.querySelector(".file-input");s&&t&&(s.addEventListener("click",()=>{t.click()}),t.addEventListener("change",()=>{t.files.length>0&&y()}))}document.readyState!=="loading"?v():document.addEventListener("DOMContentLoaded",v);const S=document.getElementById("send-message"),L=document.getElementById("chat-message");S&&S.addEventListener("click",y),L&&L.addEventListener("keypress",s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),y())}),b(L),document.addEventListener("DOMContentLoaded",()=>{const s=u?u.querySelector("li"):null;s&&s.click()});const M=document.getElementById("toggle-pinned");M&&M.addEventListener("click",()=>{f=!f,M.textContent=f?"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è":"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ",I(f)}),$()});
